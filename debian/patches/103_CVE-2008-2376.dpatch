#! /bin/sh /usr/share/dpatch/dpatch-run
## 103_CVE-2008-2376.dpatch by Jamie Strandboge <jamie@ubuntu.com>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: Ubuntu: https://bugs.launchpad.net/bugs/246818
## DP: Upstream: http://www.debian.org/security/2008/dsa-1612
## DP: Description: CVE-2008-2376

@DPATCH@
diff -urNad ruby1.8-1.8.6.111~/array.c ruby1.8-1.8.6.111/array.c
--- ruby1.8-1.8.6.111~/array.c	2008-10-07 13:32:46.000000000 -0500
+++ ruby1.8-1.8.6.111/array.c	2008-10-07 13:32:57.000000000 -0500
@@ -2272,6 +2272,12 @@
 	break;
     }
     rb_ary_modify(ary);
+    if (len < 0) {
+        return ary;
+    }
+    if (beg >= ARY_MAX_SIZE || len > ARY_MAX_SIZE - beg) {
+	rb_raise(rb_eArgError, "argument too big");
+    }
     end = beg + len;
     if (end < 0) {
 	rb_raise(rb_eArgError, "argument too big");
